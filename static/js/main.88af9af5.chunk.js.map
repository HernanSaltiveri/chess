{"version":3,"sources":["engine/engine.worker.js","ui/img/white_pawn.svg","ui/img/black_pawn.svg","ui/img/white_knight.svg","ui/img/black_knight.svg","ui/img/white_bishop.svg","ui/img/black_bishop.svg","ui/img/white_rook.svg","ui/img/black_rook.svg","ui/img/white_queen.svg","ui/img/black_queen.svg","ui/img/white_king.svg","ui/img/black_king.svg","ui/Field.js","ui/Piece.js","ui/Board.js","engine/constants.js","ui/AnimatedSpinner.js","ui/GameMenu.js","engine/engine-wasm-interop.js","ui/Game.js","ui/App.js","index.js"],"names":["addMethods","methods","module","exports","w","Worker","name","FieldDiv","styled","div","props","isRotated","markColor","Field","boardIndex","children","movePiece","isStart","isEnd","isPossibleTarget","useDrop","accept","drop","item","monitor","pieceId","dropRef","fieldMarkStyle","ref","style","position","className","whiteImages","whitePawn","whiteKnight","whiteBishop","whiteRook","whiteQueen","whiteKing","blackImages","blackPawn","blackKnight","blackBishop","blackRook","blackQueen","blackKing","pieceNames","PieceContainer","PieceImage","img","Piece","color","piece","onPickup","onDrop","Math","abs","useDrag","type","begin","end","dropResult","collect","isDragging","drag","src","alt","BoardGrid","Board","board","lastMove","currentPieceMoves","handlePlayerMove","updatePossibleMoves","clearPossibleMoves","map","idx","key","start","has","AnimatedSpinner","MenuBar","MenuItem","hidden","GameButton","button","GameResult","IconRadioInput","input","IconRadioLabel","label","getGameResultIcon","winningPlayerColor","humanPlayerColor","faMedal","faRobot","faBalanceScale","IconRadioButtons","currentValue","options","onChange","value","description","icon","Fragment","id","defaultChecked","e","target","htmlFor","title","size","GameMenu","isAiThinking","firstMovePlayed","gameEnded","startNewGame","switchSides","rotateBoard","difficultyLevel","setDifficultyLevel","canUndoMove","undoMove","disabled","onClick","faPlus","faExchangeAlt","faUndo","faRetweet","faDiceOne","faDiceTwo","faDiceThree","faDiceFour","faDiceFive","Engine","this","engine","instantiate","fetch","console","log","newGame","playerColor","depth","boardArray","__allocArray","INT32ARRAY_ID","boardPtr","__retain","moveEncoded","calculateMove","move","Move","fromEncodedMove","__release","newBoardPtr","performMove","encodedMove","newBoard","__getArray","movesPtr","generatePlayerMoves","moves","result","isCheckMate","engineWebWorker","engineWorkerLoader","initialBoard","GameArea","Game","useState","setRotateBoard","activePlayer","setActivePlayer","setHumanPlayerColor","setAiThinking","setBoard","setGameEnded","setLastMove","generateMoves","availableMoves","setAvailableMoves","Set","setCurrentPieceMoves","winningPlayer","setWinningPlayer","previousMoveState","setPreviousMoveState","handleAIMove","aiColor","availablePlayerMoves","length","some","canMove","previousBoard","previousLastMove","previousActivePlayer","previousAvailableMoves","prompt","toUpperCase","then","possibleMoves","filter","undefined","multiBackends","backendFactories","manager","backends","b","setup","args","forEach","apply","teardown","connectDropTarget","connectDragPreview","connectDragSource","App","DndProvider","backend","HTML5Backend","TouchBackend","a","async","init","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.88af9af5.chunk.js","sourcesContent":["\n\t\t\t\tvar addMethods = require(\"../../node_modules/workerize-loader/dist/rpc-wrapper.js\")\n\t\t\t\tvar methods = [\"calculateMove\",\"newGame\"]\n\t\t\t\tmodule.exports = function() {\n\t\t\t\t\tvar w = new Worker(__webpack_public_path__ + \"ed868db50ecb04c154f2.worker.js\", { name: \"[hash].worker.js\" })\n\t\t\t\t\taddMethods(w, methods)\n\t\t\t\t\t\n\t\t\t\t\treturn w\n\t\t\t\t}\n\t\t\t","module.exports = __webpack_public_path__ + \"static/media/white_pawn.41da1b5b.svg\";","module.exports = __webpack_public_path__ + \"static/media/black_pawn.3cab4671.svg\";","module.exports = __webpack_public_path__ + \"static/media/white_knight.3ece5029.svg\";","module.exports = __webpack_public_path__ + \"static/media/black_knight.88ad52be.svg\";","module.exports = __webpack_public_path__ + \"static/media/white_bishop.36a96cf8.svg\";","module.exports = __webpack_public_path__ + \"static/media/black_bishop.341337f4.svg\";","module.exports = __webpack_public_path__ + \"static/media/white_rook.007b43f5.svg\";","module.exports = __webpack_public_path__ + \"static/media/black_rook.e7f61dec.svg\";","module.exports = __webpack_public_path__ + \"static/media/white_queen.51d538db.svg\";","module.exports = __webpack_public_path__ + \"static/media/black_queen.87612c77.svg\";","module.exports = __webpack_public_path__ + \"static/media/white_king.9e716b1e.svg\";","module.exports = __webpack_public_path__ + \"static/media/black_king.12ae1430.svg\";","/*\n * A free and open source chess game using AssemblyScript and React\n * Copyright (C) 2019 mhonert (https://github.com/mhonert)\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\nimport { useDrop } from 'react-dnd';\nimport styled from 'styled-components/macro';\n\nconst FieldDiv = styled.div`\n  position: relative;\n  background-color: #fdf6e3;\n  \n  transform: ${props => props.isRotated ? \"rotateZ(180deg)\" : \"none\"};\n  \n  &:nth-child(even) {\n    background-color: #eee8d5;\n  }\n\n  &.move-mark:before {\n    position: absolute;\n    top: 4%;\n    left: 4%;\n    bottom: 4%;\n    right: 4%;\n    content: '';\n    display: block;\n    border: 0.5vh solid ${props => props.markColor};\n    border-radius: 50%;\n  }\n`;\n\nconst Field = ({\n  boardIndex,\n  isRotated,\n  children,\n  movePiece,\n  isStart,\n  isEnd,\n  isPossibleTarget\n}) => {\n  const [, dropRef] = useDrop({\n    accept: 'PIECE',\n    drop: (item, monitor) => {\n      movePiece(item.pieceId, item.boardIndex, boardIndex);\n    }\n  });\n\n  const fieldMarkStyle =\n    isStart || isEnd || isPossibleTarget ? 'move-mark' : '';\n\n  // prettier-ignore\n  const markColor = isPossibleTarget ? 'rgba(169,189,0,0.69)'\n                  : isStart ? '#dc322f9f'\n                  : isEnd ? '#dc322faf'\n                  : 'white';\n\n  return (\n    <FieldDiv\n      ref={dropRef}\n      isRotated={isRotated}\n      style={{ position: 'relative' }}\n      isStart={isStart}\n      markColor={markColor}\n      className={fieldMarkStyle}\n    >\n      {children}\n    </FieldDiv>\n  );\n};\n\nexport default Field;\n","/*\n * A free and open source chess game using AssemblyScript and React\n * Copyright (C) 2019 mhonert (https://github.com/mhonert)\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\nimport { useDrag } from 'react-dnd';\nimport styled from 'styled-components/macro';\n\nimport whitePawn from './img/white_pawn.svg';\nimport blackPawn from './img/black_pawn.svg';\nimport whiteKnight from './img/white_knight.svg';\nimport blackKnight from './img/black_knight.svg';\nimport whiteBishop from './img/white_bishop.svg';\nimport blackBishop from './img/black_bishop.svg';\nimport whiteRook from './img/white_rook.svg';\nimport blackRook from './img/black_rook.svg';\nimport whiteQueen from './img/white_queen.svg';\nimport blackQueen from './img/black_queen.svg';\nimport whiteKing from './img/white_king.svg';\nimport blackKing from './img/black_king.svg';\n\nconst whiteImages = [\n  whitePawn,\n  whiteKnight,\n  whiteBishop,\n  whiteRook,\n  whiteQueen,\n  whiteKing\n];\n\nconst blackImages = [\n  blackPawn,\n  blackKnight,\n  blackBishop,\n  blackRook,\n  blackQueen,\n  blackKing\n];\n\nconst pieceNames = [ 'Pawn', 'Knight', 'Bishop', 'Rook', 'Queen', 'King' ]\n\nconst PieceContainer = styled.div`\n  // Workaround for wrong Drag'n'Drop preview image rendering in Chrome (see https://github.com/react-dnd/react-dnd/issues/832)\n  -webkit-transform: rotateZ(0deg);\n`;\n\nconst PieceImage = styled.img`\n  display: block;\n  margin: 13%;\n  height: 74%;\n  width: 74%;\n\n  &.dragging {\n    visibility: hidden;\n  }\n`;\n\nconst Piece = ({ boardIndex, color, piece, onPickup, onDrop }) => {\n  const pieceId = Math.abs(piece);\n  const img =\n    color === 'black' ? blackImages[pieceId - 1] : whiteImages[pieceId - 1];\n\n  const [{ isDragging }, drag] = useDrag({\n    item: {\n      type: 'PIECE',\n      pieceId,\n      boardIndex\n    },\n    begin: monitor => onPickup(boardIndex),\n    end: dropResult => onDrop(boardIndex),\n    collect: monitor => ({\n      isDragging: !!monitor.isDragging()\n    })\n  });\n\n  return (\n    <PieceContainer ref={drag}>\n      <PieceImage\n        src={img}\n        alt={pieceNames[pieceId - 1]}\n        className={isDragging ? 'dragging' : ''}\n      />\n    </PieceContainer>\n  );\n};\n\nexport default Piece;\n","/*\n * A free and open source chess game using AssemblyScript and React\n * Copyright (C) 2019 mhonert (https://github.com/mhonert)\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\nimport { __ } from '../engine/constants';\nimport Field from './Field';\nimport Piece from './Piece';\nimport styled from 'styled-components/macro';\n\nconst BoardGrid = styled.div`\n    display: grid;\n    grid-template-columns: 0 repeat(8, 1fr);\n    grid-template-rows: 0 repeat(8, 1fr);\n\n    box-shadow: ${props => props.isRotated ? \"-3px -3px 3px\" : \"3px 3px 3px\"} #586e75;\n    \n    transform: rotateZ(${props => props.isRotated ? \"180deg\" : \"0deg\"});\n    \n    // always keep board size rectangular and maximized to the smaller axis\n    @media (min-aspect-ratio: 99/100) {\n          width: 100vh;\n          height: 100vh;\n    }\n    @media (max-aspect-ratio: 100/99) {\n          width: 100vw;\n          height: 100vw;\n    }\n`;\n\nconst Board = ({board, isRotated, lastMove, currentPieceMoves, handlePlayerMove, updatePossibleMoves, clearPossibleMoves}) => {\n  return (\n    <BoardGrid isRotated={isRotated}>\n      {board.map((item, idx) => {\n        if (idx % 10 === 9 || idx >= 100 || idx < 10) {\n          return null; // skip\n        }\n\n        if (item === __) {\n          return <div key={idx} className=\"board_frame\" />;\n        }\n\n        return (\n          <Field\n            key={idx}\n            boardIndex={idx}\n            movePiece={handlePlayerMove}\n            isRotated={isRotated}\n            isStart={idx === lastMove.start}\n            isEnd={idx === lastMove.end}\n            isPossibleTarget={currentPieceMoves.has(idx)}\n          >\n            {item !== 0 && (\n              <Piece\n                boardIndex={idx}\n                color={item < 0 ? 'black' : 'white'}\n                piece={item}\n                onPickup={updatePossibleMoves}\n                onDrop={clearPossibleMoves}\n              />\n            )}\n          </Field>\n        );\n      })}\n    </BoardGrid>\n  );\n};\n\nexport default Board;","/*\n * A free and open source chess game using AssemblyScript and React\n * Copyright (C) 2019 mhonert (https://github.com/mhonert)\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nexport const BLACK = -1;\nexport const WHITE = 1;\n\nexport const __ = 99; // board border\n\nexport const P = 1; // pawn\nexport const N = 2; // knight\nexport const B = 3; // bishop\nexport const R = 4; // rook\nexport const Q = 5; // queen\nexport const K = 6; // king\n","/*\n * A free and open source chess game using AssemblyScript and React\n * Copyright (C) 2019 mhonert (https://github.com/mhonert)\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport styled from 'styled-components/macro';\nimport React from 'react';\n\n/* Animated spinner adapted from https://loading.io/css/ */\nconst AnimatedSpinner = styled.div`\n  color: #073642;\n  display: inline-block;\n  position: relative;\n  width: 80px;\n  height: 80px;\n  \n  margin-top: 1rem;\n  margin-right: 0.5rem;\n  margin-left: 1.5rem;\n  \n  div {\n    transform-origin: 40px 40px;\n    animation: lds-spinner 1.2s linear infinite;\n  }\n  div:after {\n    content: \" \";\n    display: block;\n    position: absolute;\n    top: 3px;\n    left: 37px;\n    width: 6px;\n    height: 18px;\n    border-radius: 20%;\n    background: #073642;\n  }\n  div:nth-child(1) {\n    transform: rotate(0deg);\n    animation-delay: -1.1s;\n  }\n  div:nth-child(2) {\n    transform: rotate(30deg);\n    animation-delay: -1s;\n  }\n  div:nth-child(3) {\n    transform: rotate(60deg);\n    animation-delay: -0.9s;\n  }\n  div:nth-child(4) {\n    transform: rotate(90deg);\n    animation-delay: -0.8s;\n  }\n  div:nth-child(5) {\n    transform: rotate(120deg);\n    animation-delay: -0.7s;\n  }\n  div:nth-child(6) {\n    transform: rotate(150deg);\n    animation-delay: -0.6s;\n  }\n  div:nth-child(7) {\n    transform: rotate(180deg);\n    animation-delay: -0.5s;\n  }\n  div:nth-child(8) {\n    transform: rotate(210deg);\n    animation-delay: -0.4s;\n  }\n  div:nth-child(9) {\n    transform: rotate(240deg);\n    animation-delay: -0.3s;\n  }\n  div:nth-child(10) {\n    transform: rotate(270deg);\n    animation-delay: -0.2s;\n  }\n  div:nth-child(11) {\n    transform: rotate(300deg);\n    animation-delay: -0.1s;\n  }\n  div:nth-child(12) {\n    transform: rotate(330deg);\n    animation-delay: 0s;\n  }\n  @keyframes lds-spinner {\n    0% {\n      opacity: 1;\n    }\n    100% {\n      opacity: 0;\n    }\n  }\n`\n\nexport default () => (\n  <AnimatedSpinner>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n  </AnimatedSpinner>\n);\n","/*\n * A free and open source chess game using AssemblyScript and React\n * Copyright (C) 2019 mhonert (https://github.com/mhonert)\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\nimport styled from 'styled-components/macro';\nimport { WHITE } from '../engine/constants';\nimport AnimatedSpinner from './AnimatedSpinner';\nimport {\n  faBalanceScale,\n  faDiceFive,\n  faDiceFour,\n  faDiceOne,\n  faDiceThree,\n  faDiceTwo,\n  faExchangeAlt,\n  faMedal,\n  faPlus,\n  faRetweet,\n  faRobot,\n  faUndo\n} from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nconst MenuBar = styled.div`\n  display: flex;\n  flex-direction: column;\n  margin-top: 1rem;\n  margin-left: 1.5rem;\n  text-align: center;\n\n  // center menubar below board, if window width is < window height\n  @media (max-aspect-ratio: 100/99) {\n    margin-left: auto;\n    margin-right: auto;\n    flex-flow: column-reverse;\n  }\n`;\n\nconst MenuItem = styled.div`\n  position: relative;\n  display: ${props => (props.hidden ? 'none' : 'flex')};\n  padding-bottom: 0.5rem;\n  flex-direction: column;\n  \n  @media (max-aspect-ratio: 100/99) {\n    flex-direction: row;\n    align-self: center;\n  }\n`;\n\nconst GameButton = styled.button`\n  background: white;\n  color: #073642;\n  border: 1px solid #073642;\n  border-radius: 0.3rem;\n  font-size: 1rem;\n  font-weight: bold;\n  padding: 0.5rem 0.4rem;\n  width: 2.5rem;\n  margin: 0.3rem;\n  box-shadow: 1px 1px 1px #073642;\n  \n  &[disabled] {\n    display: none;\n  }\n\n  & :hover {\n    background: #073642;\n    color: white;\n    cursor: pointer;\n  }\n`;\n\nconst GameResult = styled(MenuItem)`\n  margin-top: 0.3rem;\n  font-weight: bold;\n  font-size: 1.5rem;\n  color: #073642;\n  width: 100%;\n  align-items: center;\n  \n  svg {\n    margin-left: 1rem;\n    margin-right: 1rem;\n  }\n`;\n\nconst IconRadioInput = styled.input`\n  display: none;\n  \n  &:checked + label {\n    opacity: 1;\n  }\n`;\n\nconst IconRadioLabel = styled.label`\n  color: #073642;\n  margin: 0.2rem;\n  opacity: 0.2;\n  \n  & :hover {\n    opacity: 0.5;\n    cursor: pointer;\n  }\n`\n\nconst colorName = color => (color === WHITE ? 'White' : 'Black');\n\nconst getGameResultIcon = (winningPlayerColor, humanPlayerColor) => {\n  if (!winningPlayerColor) {\n    return faBalanceScale;\n  }\n\n  return winningPlayerColor === humanPlayerColor\n    ? faMedal\n    : faRobot;\n}\n\nconst GameMenu = ({\n  isAiThinking,\n  firstMovePlayed,\n  humanPlayerColor,\n  gameEnded,\n  winningPlayerColor,\n  startNewGame,\n  switchSides,\n  rotateBoard,\n  difficultyLevel,\n  setDifficultyLevel,\n  canUndoMove,\n  undoMove,\n}) => (\n  <MenuBar>\n    {gameEnded &&\n    <GameResult>\n      <FontAwesomeIcon icon={getGameResultIcon(winningPlayerColor, humanPlayerColor)} size=\"2x\" />\n      {winningPlayerColor ? colorName(winningPlayerColor) + ' wins!' : 'Draw!'}\n    </GameResult>\n    }\n\n    <MenuItem hidden={isAiThinking}>\n\n      <GameButton disabled={!firstMovePlayed} onClick={startNewGame}>\n        <FontAwesomeIcon icon={faPlus} title=\"Start new game\" />\n      </GameButton>\n\n      <GameButton disabled={gameEnded || firstMovePlayed} onClick={switchSides}>\n        <FontAwesomeIcon icon={faExchangeAlt} title=\"Switch sides\" />\n      </GameButton>\n\n      <GameButton disabled={!canUndoMove || gameEnded} onClick={undoMove}>\n        <FontAwesomeIcon icon={faUndo} title=\"Undo move\" />\n      </GameButton>\n\n      <GameButton disabled={gameEnded || !firstMovePlayed} onClick={rotateBoard}>\n        <FontAwesomeIcon icon={faRetweet} title=\"Rotate board\" />\n      </GameButton>\n\n    </MenuItem>\n\n    <MenuItem hidden={isAiThinking || gameEnded}>\n      <IconRadioButtons currentValue={difficultyLevel} name=\"difficulty-level\" onChange={setDifficultyLevel}\n                        options={[\n                          {value: 1, description: \"Difficulty level 1 (easy)\", icon: faDiceOne},\n                          {value: 2, description: \"Difficulty level 2\", icon: faDiceTwo},\n                          {value: 3, description: \"Difficulty level 3\", icon: faDiceThree},\n                          {value: 4, description: \"Difficulty level 4\", icon: faDiceFour},\n                          {value: 5, description: \"Difficulty level 5 (hard)\", icon: faDiceFive},\n                        ]} />\n    </MenuItem>\n\n    {isAiThinking && <AnimatedSpinner /> }\n\n  </MenuBar>\n);\n\nconst IconRadioButtons = ({currentValue, name, options, onChange}) => (\n  <>\n    {options.map(({value, description, icon}) => (\n      <React.Fragment key={`${name}-${value}`}>\n        <IconRadioInput type=\"radio\" id={`${name}-${value}`} name={name} value={value} defaultChecked={currentValue === value} onChange={(e) => onChange(e.target.value)} />\n        <IconRadioLabel htmlFor={`${name}-${value}`}>\n          <FontAwesomeIcon icon={icon} title={description} size=\"2x\" />\n        </IconRadioLabel>\n      </React.Fragment>\n      ))}\n  </>\n);\n\nexport default GameMenu;\n","/*\n * A free and open source chess game using AssemblyScript and React\n * Copyright (C) 2019 mhonert (https://github.com/mhonert)\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {instantiate} from \"assemblyscript/lib/loader\";\n\n\n// Loads and interacts with the wasm engine.\nclass Engine {\n  async init() {\n    if (this.engine) {\n      return; // already initialized\n    }\n    this.engine = await instantiate(fetch(\"./as-api.wasm\"));\n    console.log(\"Engine initialized\");\n  };\n\n  newGame() {\n    this.engine.newGame();\n  }\n\n  calculateMove(board, playerColor, depth) {\n    console.log('Start calculation of move ...');\n\n    const boardArray  = this.engine.__allocArray(this.engine.INT32ARRAY_ID, board);\n    const boardPtr = this.engine.__retain(boardArray);\n\n    const moveEncoded = this.engine.calculateMove(boardPtr, playerColor, depth);\n\n    const move = Move.fromEncodedMove(moveEncoded);\n\n    this.engine.__release(boardPtr);\n\n    console.log('Calculation finished');\n\n    return move;\n  }\n\n  performMove(board, move) {\n    const boardArray  = this.engine.__allocArray(this.engine.INT32ARRAY_ID, board);\n    const boardPtr = this.engine.__retain(boardArray);\n\n    const newBoardPtr = this.engine.performMove(boardPtr, move.encodedMove);\n\n    const newBoard = this.engine.__getArray(newBoardPtr);\n\n    this.engine.__release(boardPtr);\n    this.engine.__release(newBoardPtr);\n\n    return newBoard;\n  }\n\n  generateMoves(board, playerColor) {\n    const boardArray  = this.engine.__allocArray(this.engine.INT32ARRAY_ID, board);\n    const boardPtr = this.engine.__retain(boardArray);\n\n    const movesPtr = this.engine.generatePlayerMoves(boardPtr, playerColor);\n\n    const moves = this.engine.__getArray(movesPtr);\n\n    this.engine.__release(movesPtr);\n    this.engine.__release(boardPtr);\n\n    return moves.map(Move.fromEncodedMove);\n  }\n\n  isCheckMate(board, playerColor) {\n    const boardArray  = this.engine.__allocArray(this.engine.INT32ARRAY_ID, board);\n    const boardPtr = this.engine.__retain(boardArray);\n\n    const result = this.engine.isCheckMate(boardPtr, playerColor);\n\n    this.engine.__release(boardPtr);\n\n    return result;\n  }\n}\n\nexport class Move {\n  constructor(piece, start, end) {\n    this.piece = piece;\n    this.start = start;\n    this.end = end;\n    this.encodedMove = piece | (start << 3) | (end << 10);\n  }\n\n  static fromEncodedMove(encodedMove) {\n    const piece = encodedMove & 0x7; // Bits 0-2\n    const start = (encodedMove >> 3) & 0x7F; // Bits 3-10\n    const end = (encodedMove >> 10) & 0x7F; // Bit 10-17\n\n    return new Move(piece, start, end);\n  }\n}\n\nexport default new Engine();\n\n","/*\n * A free and open source chess game using AssemblyScript and React\n * Copyright (C) 2019 mhonert (https://github.com/mhonert)\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React, { useState } from 'react';\nimport styled from 'styled-components/macro';\n\nimport engineWorkerLoader from 'workerize-loader!../engine/engine.worker'; // eslint-disable-line import/no-webpack-loader-syntax\nimport { __, B, BLACK, K, N, P, Q, R, WHITE } from '../engine/constants';\nimport Board from './Board';\nimport GameMenu from './GameMenu';\nimport engine, { Move } from '../engine/engine-wasm-interop';\n\nconst engineWebWorker = engineWorkerLoader();\n\nconst initialState = 0;\n\nconst initialBoard = [\n  __, __, __, __, __, __, __, __, __, __,\n  __, __, __, __, __, __, __, __, __, __,\n  __, -R, -N, -B, -Q, -K, -B, -N, -R, __,\n  __, -P, -P, -P, -P, -P, -P, -P, -P, __,\n  __,  0,  0,  0,  0,  0,  0,  0,  0, __,\n  __,  0,  0,  0,  0,  0,  0,  0,  0, __,\n  __,  0,  0,  0,  0,  0,  0,  0,  0, __,\n  __,  0,  0,  0,  0,  0,  0,  0,  0, __,\n  __,  P,  P,  P,  P,  P,  P,  P,  P, __,\n  __,  R,  N,  B,  Q,  K,  B,  N,  R, __,\n  __, __, __, __, __, __, __, __, __, __,\n  __, __, __, __, __, __, __, __, __, __, 0, 0, initialState\n];\n\nconst GameArea = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n`;\n\nconst Game = () => {\n  const [rotateBoard, setRotateBoard] = useState(false);\n  const [activePlayer, setActivePlayer] = useState(WHITE);\n  const [humanPlayerColor, setHumanPlayerColor] = useState(WHITE);\n  const [isAiThinking, setAiThinking] = useState(false);\n  const [board, setBoard] = useState(initialBoard);\n  const [gameEnded, setGameEnded] = useState(false);\n  const [lastMove, setLastMove] = useState({ start: -1, end: -1 });\n  const [availableMoves, setAvailableMoves] = useState(engine.generateMoves(board, activePlayer));\n  const [currentPieceMoves, setCurrentPieceMoves] = useState(new Set());\n  const [winningPlayer, setWinningPlayer] = useState();\n  const [difficultyLevel, setDifficultyLevel] = useState(3);\n  const [previousMoveState, setPreviousMoveState] = useState();\n\n  const clearAvailableMoves = () => setAvailableMoves([]);\n\n  const nextPlayer = playerColor => -playerColor;\n\n  const handleAIMove = (board, move, aiColor) => {\n    setAiThinking(false);\n\n    setLastMove(move);\n\n    const newBoard = engine.performMove(board, move);\n    setBoard(newBoard);\n\n    if (engine.isCheckMate(newBoard, -aiColor)) {\n      setGameEnded(true);\n      setWinningPlayer(aiColor);\n\n      return;\n    }\n\n    const availablePlayerMoves = engine.generateMoves(newBoard, -aiColor);\n    setAvailableMoves(availablePlayerMoves);\n\n    if (availablePlayerMoves.length === 0) {\n      setGameEnded(true);\n\n      return;\n    }\n\n    setActivePlayer(nextPlayer(aiColor));\n  };\n\n  const canMove = (start, end) => {\n    return availableMoves.some(\n      move => move.start === start && move.end === end\n    );\n  };\n\n  const switchSides = () => {\n    setRotateBoard(true);\n    setAiThinking(true);\n    setHumanPlayerColor(-humanPlayerColor);\n    engineWebWorker\n      .calculateMove(board, activePlayer, difficultyLevel)\n      .then(move => handleAIMove(board, move, activePlayer));\n  };\n\n  const startNewGame = () => {\n    engineWebWorker.newGame()\n      .then(() => {\n        setRotateBoard(false);\n        setPreviousMoveState(undefined);\n        setBoard(initialBoard);\n        setActivePlayer(WHITE);\n        setHumanPlayerColor(WHITE);\n        setGameEnded(false);\n        setLastMove({ start: -1, end: -1 });\n        setWinningPlayer(undefined);\n        setAvailableMoves(engine.generateMoves(initialBoard, WHITE));\n        setCurrentPieceMoves(new Set());\n      });\n  };\n\n  const undoMove = () => {\n    const {previousBoard, previousLastMove, previousActivePlayer, previousAvailableMoves} = previousMoveState;\n    setBoard(previousBoard);\n    setLastMove(previousLastMove);\n    setActivePlayer(previousActivePlayer)\n    setAvailableMoves(previousAvailableMoves);\n\n    setPreviousMoveState(undefined);\n  }\n\n  const saveCurrentMoveState = () => {\n    setPreviousMoveState({\n      previousBoard: board,\n      previousLastMove: lastMove,\n      previousActivePlayer: activePlayer,\n      previousAvailableMoves: availableMoves\n    })\n  }\n\n  const handlePlayerMove = (piece, start, end) => {\n    let pieceId = Math.abs(piece);\n    if (gameEnded || isAiThinking) {\n      return;\n    }\n\n    if (!canMove(start, end)) {\n      return;\n    }\n\n    saveCurrentMoveState();\n    setLastMove({ start, end });\n\n    // TODO: Replace browser prompt dialog with own dialog\n    if (pieceId === P && ((activePlayer === WHITE && end < 29) || (activePlayer === BLACK && end > 90))) {\n      // Promotion\n      const choice = prompt('Choose promotion (Q, R, B, K)', 'Q');\n      switch (choice.toUpperCase()) {\n        case 'R':\n          pieceId = R;\n          break;\n        case 'B':\n          pieceId = B;\n          break;\n        case 'K':\n          pieceId = K;\n          break;\n        case 'Q':\n        default:\n          pieceId = Q;\n          break;\n      }\n    }\n\n    const newBoard = engine.performMove(board, new Move(pieceId, start, end));\n    setBoard(newBoard);\n\n    if (engine.isCheckMate(newBoard, -activePlayer)) {\n      setGameEnded(true);\n      setWinningPlayer(activePlayer);\n\n      return;\n    }\n\n    const moves = engine.generateMoves(newBoard, -activePlayer);\n\n    if (moves.length === 0) {\n      setGameEnded(true);\n      return;\n    }\n\n    setAiThinking(true);\n    clearAvailableMoves();\n    engineWebWorker\n      .calculateMove(newBoard, -activePlayer, difficultyLevel)\n      .then(move => handleAIMove(newBoard, move, -activePlayer));\n\n    setActivePlayer(-activePlayer);\n  };\n\n  const updatePossibleMoves = start => {\n    const possibleMoves = availableMoves\n      .filter(move => move.start === start)\n      .map(move => move.end);\n    setCurrentPieceMoves(new Set(possibleMoves));\n  };\n\n  const clearPossibleMoves = () => {\n    setCurrentPieceMoves(new Set());\n  };\n\n  return (\n    <GameArea>\n      <Board\n        board={board}\n        isRotated={rotateBoard}\n        lastMove={lastMove}\n        currentPieceMoves={currentPieceMoves}\n        handlePlayerMove={handlePlayerMove}\n        updatePossibleMoves={updatePossibleMoves}\n        clearPossibleMoves={clearPossibleMoves}\n      />\n      <GameMenu\n        isAiThinking={isAiThinking}\n        firstMovePlayed={lastMove.start !== -1}\n        humanPlayerColor={humanPlayerColor}\n        gameEnded={gameEnded}\n        winningPlayerColor={winningPlayer}\n        startNewGame={startNewGame}\n        switchSides={switchSides}\n        rotateBoard={() => setRotateBoard(!rotateBoard)}\n        difficultyLevel={difficultyLevel}\n        setDifficultyLevel={setDifficultyLevel}\n        canUndoMove={!!previousMoveState}\n        undoMove={undoMove}\n      />\n    </GameArea>\n  );\n};\n\nexport default Game;\n","/*\n * A free and open source chess game using AssemblyScript and React\n * Copyright (C) 2019 mhonert (https://github.com/mhonert)\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\nimport Game from './Game';\nimport { DndProvider } from 'react-dnd';\nimport HTML5Backend from 'react-dnd-html5-backend';\nimport TouchBackend from 'react-dnd-touch-backend';\n\nconst multiBackends = (...backendFactories) =>\n  function(manager) {\n    const backends = backendFactories.map(b => b(manager));\n    return {\n      setup: (...args) =>\n        backends.forEach(b => b.setup.apply(b, args)),\n      teardown: (...args) =>\n        backends.forEach(b => b.teardown.apply(b, args)),\n      connectDropTarget: (...args) =>\n        backends.forEach(b => b.connectDropTarget.apply(b, args)),\n      connectDragPreview: (...args) =>\n        backends.forEach(b => b.connectDragPreview.apply(b, args)),\n      connectDragSource: (...args) =>\n        backends.forEach(b => b.connectDragSource.apply(b, args)),\n    };\n  };\n\nfunction App() {\n  return (\n    <main>\n      <DndProvider backend={multiBackends(HTML5Backend, TouchBackend)}>\n        <Game />\n      </DndProvider>\n    </main>\n  );\n}\n\nexport default App;\n","/*\n * A free and open source chess game using AssemblyScript and React\n * Copyright (C) 2019 mhonert (https://github.com/mhonert)\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './ui/App';\nimport engine from './engine/engine-wasm-interop';\n\n(async () => {\n  await engine.init();\n  ReactDOM.render(<App />, document.getElementById('root'));\n})();\n"],"sourceRoot":""}